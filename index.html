// Funktion, um ein farbiges Marker-Icon zu erstellen
function createColoredIcon(color) {
  return L.divIcon({
    className: '',
    html: `<svg width="12" height="12"><circle cx="6" cy="6" r="5" fill="${color}" stroke="black"/></svg>`,
    iconSize: [12, 12],
    iconAnchor: [6, 6]
  });
}

fetch('markers.json')
  .then(r => r.json())
  .then(data => {
    data.forEach((m, i) => {
      const lat = mapSize - m.coords[1];
      const lng = m.coords[0];
      // Falls keine Farbe angegeben, default auf rot
      const color = m.color || 'red';
      const icon = createColoredIcon(color);

      const marker = L.marker([lat, lng], {icon}).addTo(map)
        .bindPopup(`<strong>${m.name}</strong><br>${m.description}<br><em>X: ${m.coords[0]}, Y: ${m.coords[1]}</em>`);
      
      leafletMarkers.push(marker);

      const li = document.createElement('li');
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = true;
      checkbox.id = 'marker-' + i;
      checkbox.onchange = () => {
        checkbox.checked ? map.addLayer(marker) : map.removeLayer(marker);
      };

      const label = document.createElement('label');
      label.htmlFor = checkbox.id;
      label.textContent = m.name;

      li.appendChild(checkbox);
      li.appendChild(label);
      markerList.appendChild(li);
    });
  });
